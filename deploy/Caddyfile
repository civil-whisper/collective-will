# Production: yourdomain.com
# Set DOMAIN env var or replace these placeholders before use.

{$DOMAIN} {
	handle /api/auth/subscribe {
		uri strip_prefix /api
		reverse_proxy localhost:8000
	}

	handle /api/auth/verify/* {
		uri strip_prefix /api
		reverse_proxy localhost:8000
	}

	handle /api/auth/web-session {
		uri strip_prefix /api
		reverse_proxy localhost:8000
	}

	handle /api/auth/* {
		reverse_proxy localhost:3000
	}

	handle /api/* {
		uri strip_prefix /api
		reverse_proxy localhost:8000
	}

	handle {
		reverse_proxy localhost:3000
	}
}

# Staging: staging.yourdomain.com
staging.{$DOMAIN} {
	handle /api/auth/subscribe {
		uri strip_prefix /api
		reverse_proxy localhost:8100
	}

	handle /api/auth/verify/* {
		uri strip_prefix /api
		reverse_proxy localhost:8100
	}

	handle /api/auth/web-session {
		uri strip_prefix /api
		reverse_proxy localhost:8100
	}

	handle /api/auth/* {
		reverse_proxy localhost:3100
	}

	handle /api/* {
		uri strip_prefix /api
		reverse_proxy localhost:8100
	}

	handle {
		reverse_proxy localhost:3100
	}
}
